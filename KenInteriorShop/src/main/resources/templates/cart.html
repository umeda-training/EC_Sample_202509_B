<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
<meta charset="UTF-8">
<title>カート</title>
<link th:href="@{/css/common.css}" rel="stylesheet" type="text/css">
</head>

<body>
	<div id="wrapper">
		<header>
			<h1>カート画面</h1>
		</header>
		<main>
			<span th:text="${message}"></span>
			<table border="1">
					<tr>
						<th>商品名</th>
						<th>商品画像</th>
						<th>数量</th>
						<th>金額</th>
						<th>削除</th>
					</tr>
					<th:block th:each="item : ${cart}">
							<tr>
								<td th:text="${item.itemName}">商品名</td>
								<td>
									<img th:src="|../image/${item.itemCd}.png|" th:alt="${item.itemName}">
								</td>
								<td>
									 <button class="decrease">−</button>
									 <span class="counter" th:text="${item.itemStock}"></span>
									 <button class="increase">＋</button>
								</td>
								<td class="price" th:text="${item.itemPrice * item.itemStock}"></td>
								<td>
									<form th:action="@{/user/cart}" method="post">
										<input type="submit" value="削除" name="delete">
									</form>	
								</td>
							</tr>
					</th:block>
			</table>
			<strong>合計金額：</strong><span id="total">0</span> 円
			
			<form th:action="@{/user/order}" method="get">
				<input type="submit" value="注文へ進む">
			</form>

<script>
	function updateTotal() {
		const priceCells = document.querySelectorAll(".price");
		let total = 0;
		priceCells.forEach(cell => {
			total += parseInt(cell.textContent) || 0;
		});
		document.getElementById("total").textContent = total;
		}
		
	document.addEventListener("DOMContentLoaded", () => {
		updateTotal();
		
		const rows = document.querySelectorAll("table tr");
		rows.forEach(row => {
			const decreaseBtn = row.querySelector(".decrease");
			const increaseBtn = row.querySelector(".increase");
			const counterSpan = row.querySelector(".counter");
			const priceCell = row.querySelector(".price");
			
			if (decreaseBtn && increaseBtn && counterSpan && priceCell) {
				let count = parseInt(counterSpan.textContent);
				const unitPrice = parseInt(priceCell.textContent) / count || 0;
				
				decreaseBtn.addEventListener("click", () => {
					if (count > 1) {
						count--;
						counterSpan.textContent = count;
						priceCell.textContent = unitPrice * count;
						updateTotal();
					}
				});
				
				increaseBtn.addEventListener("click", () => {
					count++;
					counterSpan.textContent = count;
					priceCell.textContent = unitPrice * count;
					updateTotal();
				});
			}
		});
	});
</script>
			
		</main>
		<footer><small>フッター</small></footer>
	</div>
</body>
</html>